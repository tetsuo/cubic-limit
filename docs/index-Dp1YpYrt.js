const t=t=>({_tag:"Hex",value:t}),e=(t,e,r,n)=>({_tag:"Hsla",h:t,s:e,l:r,a:n}),r=(t,r,n)=>e(t,r,n,1),n=r(0,0,0),s=r(360,1,1),o=t=>{switch(t._tag){case"Hex":return t.value;case"Hsla":{const{h:e,s:r,l:n,a:s}=t,o=t=>Math.round(100*t)/100,i=o(e),a=o(100*r)+"%",c=o(100*n)+"%",l=String(s);return 1===s?`hsl(${i}, ${a}, ${c})`:`hsla(${i}, ${a}, ${c}, ${l})`}}};var i=Object.freeze({__proto__:null,black:n,hex:t,hsl:r,hsla:e,toCss:o,white:s});const a=function(t,e){if("function"==typeof t)return function(){return t(arguments)?e.apply(this,arguments):t=>e(t,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(t,r){return arguments.length>=2?e(t,r):function(r){return e(r,t)}};case 3:return function(t,r,n){return arguments.length>=3?e(t,r,n):function(n){return e(n,t,r)}};case 4:return function(t,r,n,s){return arguments.length>=4?e(t,r,n,s):function(s){return e(s,t,r,n)}};case 5:return function(t,r,n,s,o){return arguments.length>=5?e(t,r,n,s,o):function(o){return e(o,t,r,n,s)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const r=arguments;return function(t){return e(t,...r)}}}},c=t=>t,l=t=>()=>t;function u(t,e,r,n,s,o,i,a,c){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return r(e(t));case 4:return n(r(e(t)));case 5:return s(n(r(e(t))));case 6:return o(s(n(r(e(t)))));case 7:return i(o(s(n(r(e(t))))));case 8:return a(i(o(s(n(r(e(t)))))));case 9:return c(a(i(o(s(n(r(e(t))))))));default:{let t=arguments[0];for(let e=1;e<arguments.length;e++)t=arguments[e](t);return t}}}function f(t,e,r,n,s,o,i,a,c){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return r(e(t.apply(this,arguments)))};case 4:return function(){return n(r(e(t.apply(this,arguments))))};case 5:return function(){return s(n(r(e(t.apply(this,arguments)))))};case 6:return function(){return o(s(n(r(e(t.apply(this,arguments))))))};case 7:return function(){return i(o(s(n(r(e(t.apply(this,arguments)))))))};case 8:return function(){return a(i(o(s(n(r(e(t.apply(this,arguments))))))))};case 9:return function(){return c(a(i(o(s(n(r(e(t.apply(this,arguments)))))))))}}}const h=()=>"3.10.19",d=Symbol.for(`effect/GlobalValue/globalStoreId/${h()}`);d in globalThis||(globalThis[d]=new Map);const g=globalThis[d],p=(t,e)=>(g.has(t)||g.set(t,e()),g.get(t)),b=t=>"function"==typeof t,y=a(2,((t,e)=>{return((t=>"object"==typeof t&&null!==t)(r=t)||b(r))&&e in t;var r}));let m=class t{self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new t(this.self)}};const _=Symbol.for("effect/Utils/YieldWrap");class S{#t;constructor(t){this.#t=t}[_](){return this.#t}}const v=p("effect/Utils/isStructuralRegion",(()=>({enabled:!1,tester:void 0}))),w=p(Symbol.for("effect/Hash/randomHashCache"),(()=>new WeakMap)),O=Symbol.for("effect/Hash"),M=t=>{if(!0===v.enabled)return 0;switch(typeof t){case"number":return A(t);case"bigint":return C(t.toString(10));case"boolean":case"symbol":return C(String(t));case"string":return C(t);case"undefined":return C("undefined");case"function":case"object":return null===t?C("null"):t instanceof Date?M(t.toISOString()):x(t)?t[O]():k(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},k=t=>(w.has(t)||w.set(t,A(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),w.get(t)),j=t=>e=>53*e^t,E=t=>3221225471&t|t>>>1&1073741824,x=t=>y(t,O),A=t=>{if(t!=t||t===1/0)return 0;let e=0|t;for(e!==t&&(e^=4294967295*t);t>4294967295;)e^=t/=4294967295;return E(e)},C=t=>{let e=5381,r=t.length;for(;r;)e=33*e^t.charCodeAt(--r);return E(e)},I=t=>{let e=6151;for(let r=0;r<t.length;r++)e=u(e,j(M(t[r])));return E(e)},N=function(){if(1===arguments.length){const t=arguments[0];return function(e){return Object.defineProperty(t,O,{value:()=>e,enumerable:!1}),e}}const t=arguments[0],e=arguments[1];return Object.defineProperty(t,O,{value:()=>e,enumerable:!1}),e},T=Symbol.for("effect/Equal");function J(){return 1===arguments.length?t=>R(t,arguments[0]):R(arguments[0],arguments[1])}function R(t,e){if(t===e)return!0;const r=typeof t;if(r!==typeof e)return!1;if("object"===r||"function"===r){if(null!==t&&null!==e){if(P(t)&&P(e))return!(M(t)!==M(e)||!t[T](e))||!(!v.enabled||!v.tester)&&v.tester(t,e);if(t instanceof Date&&e instanceof Date)return t.toISOString()===e.toISOString()}if(v.enabled){if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every(((t,r)=>R(t,e[r])));if(Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){const r=Object.keys(t),n=Object.keys(e);if(r.length===n.length){for(const n of r)if(!(n in e)||!R(t[n],e[n]))return!!v.tester&&v.tester(t,e);return!0}}return!!v.tester&&v.tester(t,e)}}return!(!v.enabled||!v.tester)&&v.tester(t,e)}const P=t=>y(t,T),$=Symbol.for("nodejs.util.inspect.custom"),L=t=>y(t,"toJSON")&&b(t.toJSON)&&0===t.toJSON.length?t.toJSON():Array.isArray(t)?t.map(L):B(t),D=t=>JSON.stringify(t,null,2),Y=(t,e)=>{let r=[];const n=JSON.stringify(t,((t,e)=>"object"==typeof e&&null!==e?r.includes(e)?void 0:r.push(e)&&(void 0!==H.fiberRefs&&F(e)?e[W](H.fiberRefs):e):e),e);return r=void 0,n},W=Symbol.for("effect/Inspectable/Redactable"),F=t=>"object"==typeof t&&null!==t&&W in t,H=p("effect/Inspectable/redactableState",(()=>({fiberRefs:void 0}))),B=t=>F(t)&&void 0!==H.fiberRefs?t[W](H.fiberRefs):t,z=(t,e)=>{switch(e.length){case 0:return t;case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let r=t;for(let t=0,n=e.length;t<n;t++)r=e[t](r);return r}}},X=Symbol.for("effect/Effect"),Z=Symbol.for("effect/Stream"),U=Symbol.for("effect/Sink"),G=Symbol.for("effect/Channel"),V={_R:t=>t,_E:t=>t,_A:t=>t,_V:h()},q={[X]:V,[Z]:V,[U]:{_A:t=>t,_In:t=>t,_L:t=>t,_E:t=>t,_R:t=>t},[G]:{_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},[T](t){return this===t},[O](){return N(this,k(this))},[Symbol.iterator](){return new m(new S(this))},pipe(){return z(this,arguments)}},K=Symbol.for("effect/Option"),Q={...q,[K]:{_A:t=>t},[$](){return this.toJSON()},toString(){return D(this.toJSON())}},tt=Object.assign(Object.create(Q),{_tag:"Some",_op:"Some",[T](t){return nt(t)&&ot(t)&&J(this.value,t.value)},[O](){return N(this,j(M(this._tag))(M(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:L(this.value)}}}),et=M("None"),rt=Object.assign(Object.create(Q),{_tag:"None",_op:"None",[T]:t=>nt(t)&&st(t),[O]:()=>et,toJSON(){return{_id:"Option",_tag:this._tag}}}),nt=t=>y(t,K),st=t=>"None"===t._tag,ot=t=>"Some"===t._tag,it=Object.create(rt),at=Symbol.for("effect/Either"),ct={...q,[at]:{_R:t=>t},[$](){return this.toJSON()},toString(){return D(this.toJSON())}},lt=Object.assign(Object.create(ct),{_tag:"Right",_op:"Right",[T](t){return ft(t)&&dt(t)&&J(this.right,t.right)},[O](){return j(M(this._tag))(M(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:L(this.right)}}}),ut=Object.assign(Object.create(ct),{_tag:"Left",_op:"Left",[T](t){return ft(t)&&ht(t)&&J(this.left,t.left)},[O](){return j(M(this._tag))(M(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:L(this.left)}}}),ft=t=>y(t,at),ht=t=>"Left"===t._tag,dt=t=>"Right"===t._tag,gt=()=>it,pt=t=>{const e=Object.create(tt);return e.value=t,e},bt=st,yt=ot,mt=t=>null==t?gt():pt(t),_t=a(2,((t,e)=>{if(yt(t))return t.value;throw e()})),St=t=>{const e=Object.create(lt);return e.right=t,e},vt=t=>{const e=Object.create(ut);return e.left=t,e},wt=ht,Ot=(t,e)=>t<=e?((t,e)=>{const r=Math.max(1,Math.floor(t)),n=new Array(r);for(let t=0;t<r;t++)n[t]=e(t);return n})(e-t+1,(e=>t+e)):[t],Mt=t=>Array.isArray(t)?t:Array.from(t),kt=a(2,((t,{onEmpty:e,onNonEmpty:r})=>xt(t)?r(Ct(t),Nt(t)):e())),jt=a(2,((t,e)=>[...t,e])),Et=t=>0===t.length,xt=t=>t.length>0,At=a(2,((t,e)=>{const r=Math.floor(e);if(((t,e)=>t<0||t>=e.length)(r,t))throw new Error(`Index ${r} out of bounds`);return t[r]})),Ct=At(0),It=t=>t[t.length-1],Nt=t=>t.slice(1),Tt=a(3,((t,e,r)=>{const n=Mt(t),s=Mt(e);if(xt(n)&&xt(s)){const t=[r(Ct(n),Ct(s))],e=Math.min(n.length,s.length);for(let o=1;o<e;o++)t[o]=r(n[o],s[o]);return t}return[]})),Jt=a(2,((t,e)=>jt((t=>t.slice(0,-1))(t),e(It(t))))),Rt=a(2,((t,e)=>Jt(t,(()=>e)))),Pt=()=>[],$t=a(2,((t,e)=>t.map(e))),Lt=a(2,((t,e)=>{if(Et(t))return[];const r=[];for(let n=0;n<t.length;n++){const s=e(t[n],n);for(let t=0;t<s.length;t++)r.push(s[t])}return r})),Dt=a(2,((t,e)=>{const r=Mt(t),n=[];for(let t=0;t<r.length;t++){const s=e(r[t],t);yt(s)&&n.push(s.value)}return n})),Yt=a(2,((t,e)=>{const r=[],n=[],s=Mt(t);for(let t=0;t<s.length;t++){const o=e(s[t],t);wt(o)?r.push(o.left):n.push(o.right)}return[r,n]})),Wt=a(3,((t,e,r)=>Mt(t).reduce(((t,e,n)=>r(t,e,n)),e))),Ft=(t,e)=>{const r=[];let n,s=t;for(;yt(n=e(s));){const[t,e]=n.value;r.push(t),s=e}return r};const Ht=t=>e=>{const r=Object.keys(e);return t.imap(t.productAll(r.map((t=>e[t]))),(t=>{const e={};for(let n=0;n<t.length;n++)e[r[n]]=t[n];return e}),(t=>r.map((e=>t[e]))))},Bt=(t,e=(e,r)=>{return(n=e,s=t,function(t){if(Array.isArray(t))return t.reduce(s,n);let e=n;for(const r of t)e=s(e,r);return e})(r);var n,s})=>({combine:t,combineMany:e}),zt=()=>Bt((t=>t),(t=>t)),Xt=t=>Bt(((e,r)=>{const n=Math.min(e.length,r.length),s=[];let o=0;for(const i of t){if(o>=n)break;s.push(i.combine(e[o],r[o])),o++}return s})),Zt=Ht({of:t=>Bt((()=>t),(()=>t)),imap:a(3,((t,e,r)=>Bt(((n,s)=>e(t.combine(r(n),r(s)))),((n,s)=>{return e(t.combineMany(r(n),(o=r,function(t){return Array.isArray(t)?t.map(o):function*(){for(const e of t)yield o(e)}()})(s)));var o})))),product:(t,e)=>Bt((([r,n],[s,o])=>[t.combine(r,s),e.combine(n,o)])),productMany:(t,e)=>{const r=Xt(e);return Bt(((e,n)=>[t.combine(e[0],n[0]),...r.combine(e.slice(1),n.slice(1))]))},productAll:Xt}),Ut=(t,e)=>({combine:t.combine,combineMany:t.combineMany,empty:e,combineAll:r=>t.combineMany(e,r)}),Gt=t=>{const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r].empty);return Ut(Zt(t),e)},Vt={partitionMap:Yt,filterMap:Dt},qt={reduce:Wt},Kt=()=>Ut(Bt(((t,e)=>t.concat(e))),[]),Qt=t=>Ut(Bt(((e,r)=>bt(e)?r:bt(r)?e:pt(t.combine(e.value,r.value)))),gt()),te=(t,e,r,n)=>({_tag:"Translate",translateX:t,translateY:e,translateZ:r,drawing:n}),ee=(t,e,r,n)=>({_tag:"Rotate",rotateX:t,rotateY:e,rotateZ:r,drawing:n}),re=(t,e,r,n)=>({_tag:"Scale",scaleX:t,scaleY:e,scaleZ:r,drawing:n}),ne=t=>({_tag:"Many",drawings:t}),se=t=>({color:pt(t),lineWidth:gt(),lineCap:gt(),lineJoin:gt()}),oe=t=>({color:gt(),lineCap:pt(t),lineWidth:gt(),lineJoin:gt()}),ie=(t,e)=>({_tag:"Fill",shape:t,style:e}),ae=t=>({color:pt(t)}),ce=(t,e)=>({_tag:"Outline",shape:t,style:e}),le=Qt(zt()),ue=Qt(zt()),fe=Qt(zt()),he=Qt(zt()),de=Gt({color:le}),ge=Gt({color:le,lineWidth:he,lineCap:ue,lineJoin:fe}),{combineAll:pe,empty:be}=Kt(),ye=Ut(Bt(((t,e)=>"Many"===t._tag&&"Many"===e._tag?ne(pe([t.drawings,e.drawings])):"Many"===t._tag?ne(pe([t.drawings,[e]])):"Many"===e._tag?ne(pe([[t],e.drawings])):ne([t,e]))),ne(be));var me=Object.freeze({__proto__:null,clipped:(t,e)=>({_tag:"Clipped",shape:t,drawing:e}),fill:ie,fillStyle:ae,lineCap:oe,lineJoin:t=>({color:gt(),lineJoin:pt(t),lineWidth:gt(),lineCap:gt()}),lineWidth:t=>({color:gt(),lineWidth:pt(t),lineCap:gt(),lineJoin:gt()}),many:ne,monoidDrawing:ye,monoidFillStyle:de,monoidOutlineStyle:ge,outline:ce,outlineColor:se,rotate:ee,scale:re,translate:te});const _e=Ut(Bt(((t,e)=>t||e),((t,e)=>{if(!0===t)return!0;for(const t of e)if(!0===t)return!0;return!1})),!1),Se=t=>({_tag:"Degrees",degrees:t}),ve=(t,e,r)=>[t,e,r],we=t=>({_tag:"Composite",shapes:t}),Oe=t=>e=>t.reduce(e,je.empty,((t,e)=>({_tag:"Path",closed:!0,points:jt(e)(t.points)}))),Me=t=>e=>t.reduce(e,je.empty,((t,e)=>({_tag:"Path",closed:!1,points:jt(e)(t.points)}))),ke=t=>{switch(t._tag){case"Radians":return t.radians*(180/Math.PI);case"Degrees":return t.degrees}},je=Gt({_tag:Ut(Bt(l("Path")),"Path"),closed:_e,points:Kt()});var Ee=Object.freeze({__proto__:null,angle:ke,closed:Oe,composite:we,degrees:Se,monoidPath:je,path:Me,point:ve,radians:t=>({_tag:"Radians",radians:t})});const xe=Symbol.for("effect/Context/Tag"),Ae=Symbol.for("effect/STM"),Ce={...q,_op:"Tag",[Ae]:V,[xe]:{_Service:t=>t,_Identifier:t=>t},toString(){return D(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[$](){return this.toJSON()},of:t=>t,context(t){return Pe(this,t)}},Ie=Symbol.for("effect/Context"),Ne={[Ie]:{_Services:t=>t},[T](t){if(Je(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!J(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[O](){return N(this,A(this.unsafeMap.size))},pipe(){return z(this,arguments)},toString(){return D(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(L)}},[$](){return this.toJSON()}},Te=t=>{const e=Object.create(Ne);return e.unsafeMap=t,e},Je=t=>y(t,Ie),Re=Te(new Map),Pe=(t,e)=>Te(new Map([[t.key,e]])),$e=a(3,((t,e,r)=>{const n=new Map(t.unsafeMap);return n.set(e.key,r),Te(n)})),Le=()=>Re,De=$e,Ye=a(2,((t,e)=>{if(!t.unsafeMap.has(e.key))throw(t=>{const e=new Error("Service not found"+(t.key?`: ${String(t.key)}`:""));if(t.stack){const r=t.stack.split("\n");if(r.length>2){const t=r[2].match(/at (.*)/);t&&(e.message=e.message+` (defined at ${t[1]})`)}}if(e.stack){const t=e.stack.split("\n");t.splice(1,3),e.stack=t.join("\n")}return e})(e);return t.unsafeMap.get(e.key)})),We=t=>()=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;function n(){}return Error.stackTraceLimit=e,Object.setPrototypeOf(n,Ce),n.key=t,Object.defineProperty(n,"stack",{get:()=>r.stack}),n},Fe=q;class He{self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new He(this.self)}}const Be=Symbol.for("effect/Micro"),ze=Symbol.for("effect/Micro/runSymbol"),Xe=t=>"object"==typeof t&&null!==t&&Be in t,Ze={...Fe,_op:"Micro",[Be]:{_A:c,_E:c,_R:c},[Symbol.iterator](){return new He(new S(this))}},Ue=function(){function t(){}return t.prototype=Ze,t}();class Ge extends Ue{[ze](t,e){this.asMicro()[ze](t,e)}}const Ve=Symbol.for("effect/Micro/MicroCause"),qe={_E:c};class Ke extends globalThis.Error{_tag;traces;[Ve];constructor(t,e,r){const n=`MicroCause.${t}`;let s,o,i;if(e instanceof globalThis.Error){s=`(${n}) ${e.name}`,o=e.message;const t=o.split("\n").length;i=e.stack?`(${n}) ${e.stack.split("\n").slice(0,t+3).join("\n")}`:`${s}: ${o}`}else s=n,o=((t,e=2)=>{if("string"==typeof t)return t;try{return"object"==typeof t?Y(t,e):String(t)}catch(e){return String(t)}})(e,0),i=`${s}: ${o}`;r.length>0&&(i+=`\n    ${r.join("\n    ")}`),super(o),this._tag=t,this.traces=r,this[Ve]=qe,this.name=s,this.stack=i}pipe(){return z(this,arguments)}toString(){return this.stack}[$](){return this.stack}}class Qe extends Ke{defect;constructor(t,e=[]){super("Die",t,e),this.defect=t}}class tr extends Ke{constructor(t=[]){super("Interrupt","interrupted",t)}}const er=vt(((t=[])=>new tr(t))()),rr=St,nr=t=>vt(((t,e=[])=>new Qe(t,e))(t)),sr=Symbol.for("effect/Micro/Env"),or={[sr]:{_R:c},pipe(){return z(this,arguments)}},ir=t=>{const e=Object.create(or);return e.refs=t,e},ar=a(2,((t,e)=>e.key in t.refs?t.refs[e.key]:e.initial)),cr=a(3,((t,e,r)=>{const n=Object.assign(Object.create(null),t.refs);return n[e.key]=r,ir(n)})),lr=a(2,((t,e)=>ir(e(Object.assign(Object.create(null),t.refs))))),ur=a(3,((t,e,r)=>kr((function(n,s){const o=ar(n,mr),i=cr(n,mr,De(o,e,r));t[ze](i,s)})))),fr="setImmediate"in globalThis?globalThis.setImmediate:t=>setTimeout(t,0);class hr{tasks=[];running=!1;scheduleTask(t,e){this.tasks.push(t),this.running||(this.running=!0,fr(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){const t=this.tasks;this.tasks=[];for(let e=0,r=t.length;e<r;e++)t[e]()}shouldYield(t){return!1}flush(){for(;this.tasks.length>0;)this.runTasks()}}const dr=Symbol.for("effect/Micro/EnvRef"),gr={...Ze,[dr]:dr,[ze](t,e){var r;(r=this,kr(((t,e)=>e(St(ar(t,r))))))[ze](t,e)}},pr=(t,e)=>p(t,(()=>{const r=Object.create(gr);return r.key=t,r.initial=e(),r})),br=pr("effect/Micro/currentAbortController",(()=>{})),yr=pr("effect/Micro/currentAbortSignal",(()=>{})),mr=pr("effect/Micro/currentContext",(()=>Le())),_r=pr("effect/Micro/currentConcurrency",(()=>"unbounded")),Sr=pr("effect/Micro/currentMaxDepthBeforeYield",(()=>2048)),vr=pr("effect/Micro/currentInterruptible",(()=>!0)),wr=pr("effect/Micro/currentScheduler",(()=>new hr)),Or=p("effect/Micro/microDepthState",(()=>({depth:0,maxDepthBeforeYield:Sr.initial}))),Mr=(t,e)=>(t=>{const e=Object.create(Ze);return e[ze]=t,e})((function r(n,s){if(e&&!1!==n.refs[vr.key]&&n.refs[yr.key].aborted)return s(er);Or.depth++,1===Or.depth&&(Or.maxDepthBeforeYield=ar(n,Sr));const o=n.refs[wr.key];if(Or.depth>=Or.maxDepthBeforeYield||o.shouldYield(n))o.scheduleTask((()=>r(n,s)),0);else try{t(n,s)}catch(t){s(nr(t))}Or.depth--})),kr=t=>Mr(t,!0),jr=t=>kr((function(e,r){r(t)})),Er=t=>jr(rr(t)),xr=t=>kr((function(e,r){r(rr(t()))})),Ar=t=>kr((function(e,r){t()[ze](e,r)})),Cr=a(2,((t,e)=>kr((function(r,n){t[ze](r,(function(t){if("Left"===t._tag)return n(t);e(t.right)[ze](r,n)}))})))),Ir=a(2,((t,e)=>kr((function(r,n){t[ze](r,(function(t){if("Left"===t._tag)return n(t);if(ar(r,yr).aborted)return n(er);const s=Xe(e)?e:"function"==typeof e?e(t.right):e;Xe(s)?s[ze](r,n):n(rr(s))}))}))));const Nr=t=>Mr((function(e,r){const n=lr(e,(function(t){return t[vr.key]=!1,t[yr.key]=(new AbortController).signal,t}));t[ze](n,r)}),!1),Tr=(t,e,r)=>kr((function(n,s){const o="inherit"===r?.concurrency?ar(n,_r):r?.concurrency??1,i="unbounded"===o?Number.POSITIVE_INFINITY:Math.max(1,o),[a,c]=function(t){const e=new AbortController,r=ar(t,yr);function n(){e.abort(),r.removeEventListener("abort",n)}return r.addEventListener("abort",n),[lr(t,(function(t){return t[br.key]=e,t[yr.key]=e.signal,t})),n]}(n);let l;const u=Array.from(t);let f=u.length;if(0===f)return s(St(r?.discard?void 0:[]));const h=r?.discard?void 0:new Array(f);let d=0,g=0,p=0,b=!1;!function t(){for(b=!0;g<i&&d<f;){const r=d,n=u[r];d++,g++;try{e(n,r)[ze](a,(function(e){"Left"===e._tag?void 0===l&&(l=e,f=d,c()):void 0!==h&&(h[r]=e.right),p++,g--,p===f?s(l??St(h)):!b&&g<i&&t()}))}catch(t){l=nr(t),f=d,c()}}b=!1}()})),Jr=Symbol.for("effect/Micro/Handle");class Rr extends Ge{parentSignal;[Jr];observers=new Set;_exit=void 0;_controller;isRoot;constructor(t,e){super(),this.parentSignal=t,this[Jr]=Jr,this.isRoot=void 0!==e,this._controller=e??new AbortController,this.isRoot||t.addEventListener("abort",this.unsafeInterrupt)}unsafePoll(){return this._exit??null}unsafeInterrupt=()=>{this._controller.abort()};emit(t){this._exit||(this._exit=t,this.isRoot||this.parentSignal.removeEventListener("abort",this.unsafeInterrupt),this.observers.forEach((e=>e(t))),this.observers.clear())}addObserver(t){if(this._exit)return t(this._exit);this.observers.add(t)}removeObserver(t){this.observers.delete(t)}get await(){return Ar((()=>{return this._exit?Er(this._exit):(t=t=>{function e(e){t(Er(e))}return this.addObserver(e),xr((()=>{this.removeObserver(e)}))},kr((function(e,r){let n=!1;const s=t.length>1?new AbortController:void 0,o=ar(e,yr);let i;function a(){c(i?Nr(Ir(i,jr(er))):jr(er)),void 0!==s&&s.abort()}function c(t){n||(n=!0,o.removeEventListener("abort",a),t[ze](e,r))}i=void 0===s?t(c):t(c,s.signal),n||o.addEventListener("abort",a)})));var t}))}get join(){return Cr(this.await,jr)}get interrupt(){return Ar((()=>(this.unsafeInterrupt(),this.await)))}asMicro(){return this.join}}const Pr=t=>{const e=new hr,r=((t,e)=>{const r=new AbortController,n=Object.create(null);n[br.key]=r,n[yr.key]=r.signal,n[wr.key]=e?.scheduler??new hr;const s=ir(n),o=new Rr(r.signal,r);return t[ze](cr(s,yr,o._controller.signal),(t=>{o.emit(t),e?.signal&&e.signal.removeEventListener("abort",o.unsafeInterrupt)})),e?.signal&&(e.signal.aborted?o.unsafeInterrupt():e.signal.addEventListener("abort",o.unsafeInterrupt,{once:!0})),o})(t,{scheduler:e});e.flush();const n=r.unsafePoll();return null===n?nr(r):n},$r=t=>{const e=Pr(t);if("Left"===e._tag)throw e.left;return e.right},Lr=a(2,((t,e)=>t+e)),Dr=a(2,((t,e)=>t*e)),Yr=t=>e=>u(Tt(e,t,Dr),Wt(0,Lr)),Wr=t=>Math.sin(t*Math.PI/180),Fr=t=>Math.cos(t*Math.PI/180),Hr=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],Br=t=>e=>zr.combine(e,t),zr=Bt(((t,e)=>{return u($t(u(Ct(r=e),$t(((t,e)=>Xr(e)(r)))),Yr),(e=>$t(t,(t=>$t(e,(e=>e(t)))))));var r}));Ut(zr,Hr);const Xr=t=>$t(At(t)),Zr=t=>isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2]),Ur=t=>{switch(t._tag){case"Composite":return qt.reduce(t.shapes,[],((t,e)=>t.concat(Ur(e))));case"Path":return u(t.points,kt({onEmpty:Pt,onNonEmpty:(e,r)=>u(r,$t(Vr),Wt(Gr(e)([]),((t,e)=>e(t))),(e=>t.closed?qr(e).slice(0,-1):e))}))}},Gr=t=>e=>Zr(t)?jt(e,[t]):e,Vr=t=>e=>Zr(t)?xt(e)?u(e,Jt(jt(t))):Gr(t)(e):e,qr=t=>{if(!xt(t))return t;const e=It(t);if(!(xt(e)&&e.length>1))return t;const r=It(e),n=e[0];return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]?t:jt(Rt(jt(e,n))(t),[n])},Kr=t=>xt(t)?pt(t):gt(),Qr=Vt.filterMap(c);const tn=[[1,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,1]],en=(t,e)=>u(Ur(t),$t(Kr),Qr,$t($t(jt(1))),$t(Br(e)),$t(Br(tn)));class rn extends(We("Render")()){}const nn=Er(void 0),sn=t=>{return(e=rn,kr((function(t,r){r(rr(Ye(ar(t,mr),e)))}))).pipe(Ir((e=>{const r=t=>u(e.save(),Ir((()=>t)),Ir(e.restore)),n=(t,e)=>yt(t)?e(t.value):nn,s=kt({onEmpty:()=>nn,onNonEmpty:(t,r)=>u(e.moveTo(t),Ir((()=>Tr(r,e.lineTo,{discard:!0}))))}),i=t=>a=>{switch(a._tag){case"Many":return Tr(a.drawings,i(t),{discard:!0});case"Scale":return i(Br([[(c=[a.scaleX,a.scaleY,a.scaleZ])[0],0,0,0],[0,c[1],0,0],[0,0,c[2],0],[0,0,0,1]])(t))(a.drawing);case"Rotate":return i(zr.combine(Br((t=>[[1,0,0,0],[0,Fr(t),Wr(t),0],[0,-Wr(t),Fr(t),0],[0,0,0,1]])(ke(a.rotateX)))((t=>[[Fr(t),0,-Wr(t),0],[0,1,0,0],[Wr(t),0,Fr(t),0],[0,0,0,1]])(ke(a.rotateY))),Br((t=>[[Fr(t),Wr(t),0,0],[-Wr(t),Fr(t),0,0],[0,0,0,0],[0,0,0,1]])(ke(a.rotateZ)))(t)))(a.drawing);case"Translate":return i(Br((t=>[[1,0,0,0],[0,1,0,0],[0,0,1,0],[t[0],t[1],t[2],1]])([a.translateX,a.translateY,a.translateZ]))(t))(a.drawing);case"Outline":return r(u(n(a.style.color,f(o,e.setStrokeStyle)),Ir((()=>n(a.style.lineWidth,e.setLineWidth))),Ir((()=>n(a.style.lineCap,e.setLineCap))),Ir((()=>n(a.style.lineJoin,e.setLineJoin))),Ir(e.beginPath),Ir((()=>Tr(en(a.shape,t),s,{discard:!0}))),Ir(e.stroke)));case"Fill":return r(u(n(a.style.color,f(o,e.setFillStyle)),Ir(e.beginPath),Ir((()=>Tr(en(a.shape,t),s,{discard:!0}))),Ir((()=>e.fill()))));case"Clipped":return r(u(e.beginPath(),Ir((()=>Tr(en(a.shape,t),s,{discard:!0}))),Ir((()=>e.clip())),Ir((()=>i(t)(a.drawing)))))}var c};return i(Hr)(t)})));var e},on=t=>xr((()=>mt((t=>document.getElementById(t))(t)))),an=f((t=>t.getContext("2d")),mt,l,xr),cn=Er(window.devicePixelRatio),ln=(t,e)=>u(on(e),Ir(_t((()=>new Error(`Unable to find canvas with id ${e}`)))),Ir((e=>{const r=e.getBoundingClientRect();return cn.pipe(Ir((n=>(e.width=r.width*n,e.height=r.height*n,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`,u(an(e),Ir(_t((()=>new Error("Unable to get context 2D")))),Ir((r=>(r.scale(n,n),((t,e)=>ur(sn(t),rn,{fill:t=>(void 0!==t?e.fill(t):e.fill(),nn),clip:t=>(void 0!==t?e.clip(t):e.clip(),nn),setFillStyle:t=>(e.fillStyle=t,nn),setStrokeStyle:t=>(e.strokeStyle=t,nn),setLineWidth:t=>(e.lineWidth=t,nn),setLineJoin:t=>(e.lineJoin=t,nn),setLineCap:t=>(e.lineCap=t,nn),stroke:()=>(e.stroke(),nn),save:()=>(e.save(),nn),restore:()=>(e.restore(),nn),lineTo:t=>(e.lineTo(t[0],t[1]),nn),moveTo:t=>(e.moveTo(t[0],t[1]),nn),beginPath:()=>(e.beginPath(),nn),closePath:()=>(e.closePath(),nn)}))(t({height:e.height/n,width:e.width/n}),r)))))))))}))).pipe($r);export{t as A,Me as B,we as C,Lt as D,ve as E,qt as F,i as G,me as H,Ee as S,I as a,T as b,N as c,ln as d,J as e,ie as f,ae as g,ne as h,re as i,$t as j,f as k,oe as l,ge as m,Se as n,se as o,u as p,Oe as q,ee as r,O as s,te as t,Ft as u,ce as v,s as w,Ot as x,pt as y,gt as z};
